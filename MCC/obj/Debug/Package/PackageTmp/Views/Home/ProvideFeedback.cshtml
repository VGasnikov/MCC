@using MCC.Domain
@model Feedback
@{
    ViewBag.Title = TranslationRepository.GetLabel("Layout", "ProvideFeedback") + " | " + Audience.Current.ToString().ToUpper();
    ViewBag.BackgroundImageClass = "provide-feedback";
}
@helper Translate(string field)
{
    @Html.Translate(field, "ProvideFeedback")
}
<link href="~/Scripts/bootstrap-datetimepicker.css" rel="stylesheet" />
<script src="~/Scripts/moment-with-locales.js"></script>
<script src="~/Scripts/bootstrap-datetimepicker.js"></script>
<script>
    function gi(id) { return document.getElementById(id)}
    function displayField(d,i,b){
        gi(d).style.display = b ? "" : "none";
        var ht = gi(i);
        if (b) ht.setAttribute("required","true"); else ht.removeAttribute("required");
        ht.value = "";
    }

    $(document).ready(function () {
        var displayTopic = function () {
            var ch = gi("ch").checked;
            var ct = gi("ct").checked;
            var t = $('#FeedbackType').val();
            if (!ch && !ct || t == '') return;
            displayField("hTopic", "HotelTopic", t == 0 && ch);
            displayField("tTopic", "TransportTopic", t == 0 && ct);
            $('#form').validator('update');
        }
        var displayHotelDetails = function () {           
            var ch = gi("ch").checked;
            var ct = gi("ct").checked;
            displayField("dHotel", "Hotel", ch);
            displayField("dTransportCompany", "TransportCompany", ct);
            displayField("dRoomNumber", "RoomNumber", ch);
            gi("dHotelAttention").style.display = ch ? "" : "none";
            $('#form').validator('update');
        }
        displayHotelDetails();
        displayTopic();

        $('#FeedbackType').change(displayTopic);
        $('input[type=radio][name=Category]').change(function () {
            displayHotelDetails();
            displayTopic();
        });
    });

</script>
<style>
/* leave this part out */

.clearfix{*zoom:1;}.clearfix:before,.clearfix:after{display:table;content:"";line-height:0;}
.clearfix:after{clear:both;}
.hide-text{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;}
.input-block-level{display:block;width:100%;min-height:30px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}
.btn-file{overflow:hidden;position:relative;vertical-align:middle;}.btn-file>input{position:absolute;top:0;right:0;margin:0;opacity:0;filter:alpha(opacity=0);transform:translate(-300px, 0) scale(4);font-size:23px;direction:ltr;cursor:pointer;}
.fileupload{margin-bottom:9px;}.fileupload .uneditable-input{display:inline-block;margin-bottom:0px;vertical-align:middle;cursor:text;}
.fileupload .thumbnail{overflow:hidden;display:inline-block;margin-bottom:5px;vertical-align:middle;text-align:center;}.fileupload .thumbnail>img{display:inline-block;vertical-align:middle;max-height:100%;}
.fileupload .btn{vertical-align:middle;}
.fileupload-exists .fileupload-new,.fileupload-new .fileupload-exists{display:none;}
.fileupload-inline .fileupload-controls{display:inline;}
.fileupload-new .input-append .btn-file{-webkit-border-radius:0 3px 3px 0;-moz-border-radius:0 3px 3px 0;border-radius:0 3px 3px 0;}
.thumbnail-borderless .thumbnail{border:none;padding:0;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;}
.fileupload-new.thumbnail-borderless .thumbnail{border:1px solid #ddd;}
.control-group.warning .fileupload .uneditable-input{color:#a47e3c;border-color:#a47e3c;}
.control-group.warning .fileupload .fileupload-preview{color:#a47e3c;}
.control-group.warning .fileupload .thumbnail{border-color:#a47e3c;}
.control-group.error .fileupload .uneditable-input{color:#b94a48;border-color:#b94a48;}
.control-group.error .fileupload .fileupload-preview{color:#b94a48;}
.control-group.error .fileupload .thumbnail{border-color:#b94a48;}
.control-group.success .fileupload .uneditable-input{color:#468847;border-color:#468847;}
.control-group.success .fileupload .fileupload-preview{color:#468847;}
.control-group.success .fileupload .thumbnail{border-color:#468847;}
</style>
<script>
    !function (e) { var t = function (t, n) { this.$element = e(t), this.type = this.$element.data("uploadtype") || (this.$element.find(".thumbnail").length > 0 ? "image" : "file"), this.$input = this.$element.find(":file"); if (this.$input.length === 0) return; this.name = this.$input.attr("name") || n.name, this.$hidden = this.$element.find('input[type=hidden][name="' + this.name + '"]'), this.$hidden.length === 0 && (this.$hidden = e('<input type="hidden" />'), this.$element.prepend(this.$hidden)), this.$preview = this.$element.find(".fileupload-preview"); var r = this.$preview.css("height"); this.$preview.css("display") != "inline" && r != "0px" && r != "none" && this.$preview.css("line-height", r), this.original = { exists: this.$element.hasClass("fileupload-exists"), preview: this.$preview.html(), hiddenVal: this.$hidden.val() }, this.$remove = this.$element.find('[data-dismiss="fileupload"]'), this.$element.find('[data-trigger="fileupload"]').on("click.fileupload", e.proxy(this.trigger, this)), this.listen() }; t.prototype = { listen: function () { this.$input.on("change.fileupload", e.proxy(this.change, this)), e(this.$input[0].form).on("reset.fileupload", e.proxy(this.reset, this)), this.$remove && this.$remove.on("click.fileupload", e.proxy(this.clear, this)) }, change: function (e, t) { if (t === "clear") return; var n = e.target.files !== undefined ? e.target.files[0] : e.target.value ? { name: e.target.value.replace(/^.+\\/, "") } : null; if (!n) { this.clear(); return } this.$hidden.val(""), this.$hidden.attr("name", ""), this.$input.attr("name", this.name); if (this.type === "image" && this.$preview.length > 0 && (typeof n.type != "undefined" ? n.type.match("image.*") : n.name.match(/\.(gif|png|jpe?g)$/i)) && typeof FileReader != "undefined") { var r = new FileReader, i = this.$preview, s = this.$element; r.onload = function (e) { i.html('<img src="' + e.target.result + '" ' + (i.css("max-height") != "none" ? 'style="max-height: ' + i.css("max-height") + ';"' : "") + " />"), s.addClass("fileupload-exists").removeClass("fileupload-new") }, r.readAsDataURL(n) } else this.$preview.text(n.name), this.$element.addClass("fileupload-exists").removeClass("fileupload-new") }, clear: function (e) { this.$hidden.val(""), this.$hidden.attr("name", this.name), this.$input.attr("name", ""); if (navigator.userAgent.match(/msie/i)) { var t = this.$input.clone(!0); this.$input.after(t), this.$input.remove(), this.$input = t } else this.$input.val(""); this.$preview.html(""), this.$element.addClass("fileupload-new").removeClass("fileupload-exists"), e && (this.$input.trigger("change", ["clear"]), e.preventDefault()) }, reset: function (e) { this.clear(), this.$hidden.val(this.original.hiddenVal), this.$preview.html(this.original.preview), this.original.exists ? this.$element.addClass("fileupload-exists").removeClass("fileupload-new") : this.$element.addClass("fileupload-new").removeClass("fileupload-exists") }, trigger: function (e) { this.$input.trigger("click"), e.preventDefault() } }, e.fn.fileupload = function (n) { return this.each(function () { var r = e(this), i = r.data("fileupload"); i || r.data("fileupload", i = new t(this, n)), typeof n == "string" && i[n]() }) }, e.fn.fileupload.Constructor = t, e(document).on("click.fileupload.data-api", '[data-provides="fileupload"]', function (t) { var n = e(this); if (n.data("fileupload")) return; n.fileupload(n.data()); var r = e(t.target).closest('[data-dismiss="fileupload"],[data-trigger="fileupload"]'); r.length > 0 && (r.trigger("click.fileupload"), t.preventDefault()) }) }(window.jQuery)
</script>
<script src="~/Scripts/validator.js"></script>
<div class="container white-container main-content" id="main-content-scroll">
    <h1>@Translate("ProvideFeedback")</h1>
    <form class="form-horizontal" id="form"  data-toggle="validator" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label"></label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <label class="radio-inline"><input type="radio" id="ch" required value="0" name="Category">@Translate("Hotel")</label>
                <label class="radio-inline"><input type="radio" id="ct" required value="1" name="Category">@Translate("Transport")</label>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="FeedbackType">
                <span class="required">*</span>
                @Translate("FeedbackType"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <select id="FeedbackType" name="FeedbackType" required class="form-control">
                    <option value="">@Html.Translate("PleaseSelect")</option>
                    <option value="0">@Translate("Complaint")</option>
                    <option value="1">@Translate("Compliment")</option>
                </select>
            </div>
        </div>
        <div class="form-group" id="hTopic" style="display:none">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="HotelTopic">
                <span class="required">*</span>
                @Translate("Topic"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <select id="HotelTopic" required name="FeedbackTopicId" class="form-control">
                    <option value="">@Html.Translate("PleaseSelect")</option>
                    @foreach (var h in FeedbackTopicRepository.GetFeedbackTopicByCategory(FeedbackCategory.Hotel, Audience.Current.Airline.Id))
                    {
                        <option value="@h.FeedbackTopicId">@h.Name</option>
                    }
                </select>
            </div>
        </div>
        <div class="form-group" id="tTopic" style="display:none">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="TransportTopic">
                <span class="required">*</span>
                @Translate("Topic"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <select id="TransportTopic" required name="FeedbackTopicId" class="form-control">
                    <option value="">@Html.Translate("PleaseSelect")</option>
                    @foreach (var h in FeedbackTopicRepository.GetFeedbackTopicByCategory(FeedbackCategory.Transport, Audience.Current.Airline.Id))
                    {
                        <option value="@h.FeedbackTopicId">@h.Name</option>
                    }
                </select>
            </div>
        </div>
        <div class="form-group" id="dTransportCompany" style="display:none">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="TransportCompany">
                <span class="required">*</span>
                @Translate("TransportCompany"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <select id="TransportCompany" name="TransportCompanyId" class="form-control">
                    <option value="">@Html.Translate("PleaseSelect")</option>
                    @foreach (var h in TransportCompanyRepository.TransportCompaniesByAirline(Audience.Current.Airline.Id))
                    {
                        <option value="@h.Key">@h.Value</option>
                    }
                </select>
            </div>
        </div>
        <div class="form-group" id="dHotel" style="display:none">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="HotelId">
                <span class="required">*</span>
                @Translate("HotelName"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <select id="Hotel" name="HotelId" class="form-control">
                    <option value="">@Html.Translate("PleaseSelect")</option>
                    @foreach (var h in HotelRepository.GetHotelsByAirline(Audience.Current.Airline.Id))
                    {
                        <option value="@h.Key">@h.Value</option>
                    }
                </select>
            </div>
        </div>
        <div class="form-group" id="dRoomNumber" style="display:none">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="RoomNumber">
                <span class="required">*</span>
                @Translate("RoomNumber"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8"><input type="text" name="RoomNumber" id="RoomNumber" class="form-control" /></div>
        </div>
        <div class="form-group" id="dHotelAttention" style="display:none">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label">
                @Translate("HotelAttention")
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <label class="radio-inline"><input value="false" type="radio" id="han" name="HotelAttention">@Html.Translate("No", "Global")</label>
                <label class="radio-inline"><input value="true" type="radio" id="hay" name="HotelAttention">@Html.Translate("Yes", "Global")</label>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="ArrivalFlightNumber">
                <span class="required">*</span>
                @Translate("ArrivalFlightNo"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <input type="text" name="ArrivalFlightNumber" id="ArrivalFlightNumber" required class="form-control" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="DepartureFlightNumber">
                <span class="required">*</span>
                @Translate("DepartureFlightNo"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8"><input type="text" required name="DepartureFlightNumber" id="DepartureFlightNumber" class="form-control" /></div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="CheckIn">
                <span class="required">*</span>
                @Translate("CheckIn"):
            </label>
            <div class='col-xs-12 col-sm-8 col-md-8'>@Html.DateTimePicker("CheckIn")</div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="CheckOut">
                <span class="required">*</span>
                @Translate("CheckOut"):
            </label>
            <div class='col-xs-12 col-sm-8 col-md-8'>@Html.DateTimePicker("CheckOut")</div>
        </div>
        @Html.Partial("ProvideFeedback_FirstLastName")
        @if (Audience.Current.Airline.DisplayBranchInFeedback)
        {
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="Branch">
                <span class="required">*</span> @Translate("Branch"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <select id="Branch" name="BranchId" class="form-control">
                    <option value="">@Html.Translate("PleaseSelect")</option>
                    @foreach (var h in BranchRepository.GetBranchesByAirline(Audience.Current.Airline.Id))
                    {
                        <option value="@h.Key">@h.Value</option>
                    }
                </select>
            </div>
        </div>
        }
        @if (  Audience.Current.Airline.Id.ToString().Equals(Airline.AirNewZealand,StringComparison.InvariantCultureIgnoreCase) 
            || Audience.Current.Airline.Id.ToString().Equals(Airline.VirginAustralia,StringComparison.InvariantCultureIgnoreCase))
        {
            <div class="form-group">
                <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="ResourceGroup">
                    <span class="required">*</span> @Translate("ResourceGroup"):
                </label>
                <div class="col-xs-12 col-sm-8 col-md-8">
                    <select id="ResourceGroup" name="ResourceGroup" class="form-control">
                        <option value="">@Html.Translate("PleaseSelect")</option>
                        @foreach (var h in FeedbackResourceRepository.GetFeedbackResources(Audience.Current.Airline.Id))
                        {
                            <option value="@h.Key">@h.Value</option>
                        }
                    </select>
                </div>
            </div>
        }
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="Subject">
                <span class="required">*</span>
                @Translate("Subject"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8"><input type="text" required name="Subject" id="Subject" class="form-control" /></div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="Comments">
                <span class="required">*</span> @Translate("PleaseEnterYourComments"):
            </label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <textarea rows="5" cols="20" required id="Comments" name="Comments" class="form-control"></textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-4 col-md-4 control-label" for="ImageUpload">@Translate("UploadImage"):</label>
            <div class="col-xs-12 col-sm-8 col-md-8">
                <div class="fileupload fileupload-new" data-provides="fileupload">
                    <span class="btn btn-default btn-file">
                        <span class="fileupload-new">@Html.Translate("SelectFile")</span>
                        <span class="fileupload-exists">@Html.Translate("Change")</span><input name="ImageUpload" type="file" accept=".jpg,.jpeg,.bmp,.gif,.tiff,.png" />
                    </span>
                    <span class="fileupload-preview"></span>
                    <a href="#" class="close fileupload-exists" data-dismiss="fileupload" style="float: none">×</a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 button-row">
                <input value="Submit Feedback" class="btn btn-primary btn-lg" type="submit">
            </div>
        </div>
        <input type="hidden" name="FeedbackId" id="FeedbackId" value="@Guid.NewGuid()" />
    </form>
</div>
